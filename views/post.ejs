<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="<%= post.excerpt %>">
    <meta property="og:title" content="<%= post.title %>">
    <meta property="og:description" content="<%= post.excerpt %>">
    <meta property="og:image" content="<%= post.image %>">
</head>
<body>
    <%- include('partials/header') %>
    
    <article class="post-article">
        <div class="container">
            <!-- Post Header -->
            <header class="post-header">
                <div class="post-meta">
                    <span class="category-badge"><%= post.category %></span>
                    <span class="post-date">
                        <i class="fas fa-calendar"></i>
                        <%= moment(post.createdAt).format('MMMM DD, YYYY') %>
                    </span>
                    <span class="read-time">
                        <i class="fas fa-clock"></i>
                        <%= Math.ceil(post.content.replace(/<[^>]*>/g, '').split(' ').length / 200) %> min read
                    </span>
                </div>
                
                <h1 class="post-title"><%= post.title %></h1>
                
                <div class="post-author">
                    <div class="author-info">
                        <img src="/images/logo.jpg" alt="<%= post.author %>" class="author-avatar">
                        <div class="author-details">
                            <span class="author-name">By <%= post.author %></span>
                            <span class="author-bio">Blog Author</span>
                        </div>
                    </div>
                    
                    <div class="post-actions">
                        <button class="btn-icon like-btn" data-post-id="<%= post.id %>" title="Like this post">
                            <i class="fas fa-heart"></i>
                            <span class="like-count"><%= post.likes %></span>
                        </button>
                        <button class="btn-icon share-btn" onclick="sharePost('<%= post.title %>', '/post/<%= post.slug %>')" title="Share this post">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <div class="post-stats">
                            <span class="stat">
                                <i class="fas fa-eye"></i> <%= post.views %>
                            </span>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Featured Image -->
            <div class="post-featured-image">
                <img src="<%= post.image %>" alt="<%= post.title %>">
            </div>
            
            <!-- Post Content -->
            <div class="post-content-wrapper">
                <div class="post-content">
                    <%- post.content %>
                </div>
                
                <!-- Post Tags -->
                <div class="post-tags">
                    <h4>Tags:</h4>
                    <div class="tags-list">
                        <% post.tags.forEach(tag => { %>
                            <a href="/blog?search=<%= tag %>" class="tag">#<%= tag %></a>
                        <% }); %>
                    </div>
                </div>
                
                <!-- Social Share -->
                <div class="social-share">
                    <h4>Share this post:</h4>
                    <div class="share-buttons">
                        <button class="share-btn facebook" onclick="shareOnFacebook('<%= post.title %>', '/post/<%= post.slug %>')">
                            <i class="fab fa-facebook-f"></i> Facebook
                        </button>
                        <button class="share-btn twitter" onclick="shareOnTwitter('<%= post.title %>', '/post/<%= post.slug %>')">
                            <i class="fab fa-twitter"></i> Twitter
                        </button>
                        <button class="share-btn linkedin" onclick="shareOnLinkedIn('<%= post.title %>', '/post/<%= post.slug %>')">
                            <i class="fab fa-linkedin-in"></i> LinkedIn
                        </button>
                        <button class="share-btn copy" onclick="copyToClipboard(window.location.href)">
                            <i class="fas fa-link"></i> Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </article>
    
    <!-- Comments Section -->
    <section class="comments-section">
        <div class="container">
            <h3 class="comments-title">
                <i class="fas fa-comments"></i>
                Comments (<%= comments.length %>)
            </h3>
            
            <% if (user) { %>
                <form class="comment-form" method="POST" action="/comment">
                    <input type="hidden" name="postId" value="<%= post.id %>">
                    <div class="comment-form-header">
                        <img src="<%= user.avatar %>" alt="<%= user.username %>" class="comment-avatar">
                        <span class="comment-author"><%= user.username %></span>
                    </div>
                    <textarea 
                        name="content" 
                        placeholder="Share your thoughts about this post..." 
                        required
                        minlength="10"
                        rows="4"
                    ></textarea>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Post Comment
                    </button>
                </form>
            <% } else { %>
                <div class="comment-login-prompt">
                    <p>Please <a href="/login">login</a> to leave a comment.</p>
                </div>
            <% } %>
            
            <div class="comments-list">
                <% if (comments.length > 0) { %>
                    <% comments.forEach(comment => { %>
                        <div class="comment">
                            <div class="comment-header">
                                <img src="<%= comment.avatar %>" alt="<%= comment.username %>" class="comment-avatar">
                                <div class="comment-info">
                                    <span class="comment-author"><%= comment.username %></span>
                                    <span class="comment-date">
                                        <%= moment(comment.createdAt).fromNow() %>
                                    </span>
                                </div>
                            </div>
                            <div class="comment-content">
                                <%= comment.content %>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="no-comments">
                        <i class="fas fa-comment-slash"></i>
                        <p>No comments yet. Be the first to share your thoughts!</p>
                    </div>
                <% } %>
            </div>
        </div>
    </section>
    
    <!-- Related Posts -->
    <% if (relatedPosts.length > 0) { %>
    <section class="related-posts">
        <div class="container">
            <h3 class="section-title">Related Posts</h3>
            <div class="related-posts-grid">
                <% relatedPosts.forEach(relatedPost => { %>
                    <article class="related-post-card">
                        <div class="card-image">
                            <img src="<%= relatedPost.image %>" alt="<%= relatedPost.title %>">
                            <div class="card-overlay">
                                <span class="category-badge"><%= relatedPost.category %></span>
                            </div>
                        </div>
                        <div class="card-content">
                            <h4 class="card-title">
                                <a href="/post/<%= relatedPost.slug %>"><%= relatedPost.title %></a>
                            </h4>
                            <p class="card-excerpt"><%= relatedPost.excerpt %></p>
                            <div class="card-meta">
                                <span class="date">
                                    <%= moment(relatedPost.createdAt).format('MMM DD, YYYY') %>
                                </span>
                                <span class="stats">
                                    <i class="fas fa-eye"></i> <%= relatedPost.views %>
                                </span>
                            </div>
                        </div>
                    </article>
                <% }); %>
            </div>
        </div>
    </section>
    <% } %>
    
    <%- include('partials/footer') %>
    
    <script src="/js/main.js"></script>
    <script>
        // Social sharing functions
        function shareOnFacebook(title, url) {
            const fullUrl = window.location.origin + url;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(fullUrl)}`, '_blank', 'width=600,height=400');
        }
        
        function shareOnTwitter(title, url) {
            const fullUrl = window.location.origin + url;
            const text = `Check out this post: ${title}`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(fullUrl)}`, '_blank', 'width=600,height=400');
        }
        
        function shareOnLinkedIn(title, url) {
            const fullUrl = window.location.origin + url;
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(fullUrl)}`, '_blank', 'width=600,height=400');
        }
        
        // Reading progress indicator
        function initReadingProgress() {
            const progressBar = document.createElement('div');
            progressBar.className = 'reading-progress';
            progressBar.innerHTML = '<div class="reading-progress-fill"></div>';
            document.body.appendChild(progressBar);
            
            const progressFill = progressBar.querySelector('.reading-progress-fill');
            const article = document.querySelector('.post-content');
            
            if (article) {
                window.addEventListener('scroll', () => {
                    const articleTop = article.offsetTop;
                    const articleHeight = article.offsetHeight;
                    const windowHeight = window.innerHeight;
                    const scrollTop = window.pageYOffset;
                    
                    const progress = Math.min(100, Math.max(0, 
                        ((scrollTop - articleTop + windowHeight) / articleHeight) * 100
                    ));
                    
                    progressFill.style.width = progress + '%';
                });
            }
        }
        
        // Initialize reading progress
        initReadingProgress();
    </script>
    
    <style>
        .post-article {
            padding: var(--space-8) 0;
        }
        
        .post-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        
        .post-meta {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
            flex-wrap: wrap;
        }
        
        .post-meta span {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-size-sm);
            color: var(--text-light);
        }
        
        .post-title {
            font-size: var(--font-size-4xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-8);
            line-height: 1.2;
        }
        
        .post-author {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .author-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            object-fit: cover;
        }
        
        .author-details {
            display: flex;
            flex-direction: column;
        }
        
        .author-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .author-bio {
            font-size: var(--font-size-sm);
            color: var(--text-light);
        }
        
        .post-actions {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .post-featured-image {
            margin: var(--space-12) 0;
            border-radius: var(--radius-2xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        
        .post-featured-image img {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }
        
        .post-content-wrapper {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .post-content {
            font-size: var(--font-size-lg);
            line-height: 1.8;
            color: var(--text-primary);
            margin-bottom: var(--space-12);
        }
        
        .post-content p {
            margin-bottom: var(--space-6);
        }
        
        .post-content h2,
        .post-content h3 {
            margin-top: var(--space-8);
            margin-bottom: var(--space-4);
        }
        
        .post-tags {
            margin-bottom: var(--space-8);
            padding: var(--space-6);
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
        }
        
        .post-tags h4 {
            margin-bottom: var(--space-4);
            color: var(--text-primary);
        }
        
        .tags-list {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }
        
        .social-share {
            padding: var(--space-6);
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-12);
        }
        
        .social-share h4 {
            margin-bottom: var(--space-4);
            color: var(--text-primary);
        }
        
        .share-buttons {
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
        }
        
        .share-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition-fast);
        }
        
        .share-btn.facebook {
            background: #1877f2;
            color: white;
        }
        
        .share-btn.twitter {
            background: #1da1f2;
            color: white;
        }
        
        .share-btn.linkedin {
            background: #0077b5;
            color: white;
        }
        
        .share-btn.copy {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .comments-section {
            background: var(--bg-secondary);
            padding: var(--space-16) 0;
        }
        
        .comments-title {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-8);
            color: var(--text-primary);
        }
        
        .comment-form {
            background: var(--bg-primary);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-8);
            box-shadow: var(--shadow-sm);
        }
        
        .comment-form-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            object-fit: cover;
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .comment-form textarea {
            width: 100%;
            padding: var(--space-4);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: var(--font-primary);
            resize: vertical;
            margin-bottom: var(--space-4);
        }
        
        .comment-form textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .comment-login-prompt {
            text-align: center;
            padding: var(--space-8);
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-8);
        }
        
        .comments-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }
        
        .comment {
            background: var(--bg-primary);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
        }
        
        .comment-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .comment-info {
            display: flex;
            flex-direction: column;
        }
        
        .comment-date {
            font-size: var(--font-size-sm);
            color: var(--text-light);
        }
        
        .comment-content {
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .no-comments {
            text-align: center;
            padding: var(--space-12);
            color: var(--text-light);
        }
        
        .no-comments i {
            font-size: var(--font-size-4xl);
            margin-bottom: var(--space-4);
        }
        
        .related-posts {
            padding: var(--space-16) 0;
        }
        
        .related-posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-8);
        }
        
        .related-post-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }
        
        .related-post-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .related-post-card .card-image {
            aspect-ratio: 16/9;
        }
        
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(99, 102, 241, 0.1);
            z-index: 1000;
        }
        
        .reading-progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        @media (max-width: 768px) {
            .post-title {
                font-size: var(--font-size-2xl);
            }
            
            .post-author {
                flex-direction: column;
                gap: var(--space-4);
            }
            
            .post-featured-image img {
                height: 250px;
            }
            
            .post-content {
                font-size: var(--font-size-base);
            }
            
            .share-buttons {
                justify-content: center;
            }
            
            .related-posts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
